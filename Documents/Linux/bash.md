# Shell 基本类型变量

> shell 开始执行时定义了一些和系统的工作环境相关的变量，用户可以重新定义

## shell 环境变量

- HOME 用于保存注册目录的完全路径名
- PATH 用于保存用冒号分割的目录路径名，shell 将按 PATH 变量给出的顺序检索，找到第一个与命令名称一致的可执行文件执行
- TERM 终端类型
- UID 当前用户的识别字，值是由数字构成的字符串
- PWD 当前工作目录的绝对路径名，取值随着 cd 命令的使用而变化
- PS1 主提示符，在特权用户下，默认的主提示符是 `#`，普通用户的默认提示符是 `$`
- PS2 在 shell 接收用户输入命令过程中，如果用户在输入行末尾输入 `\` 然后回车，或者用户回车 shell 判定输入命令未结束时，显示这个辅助提示符

## 用户定义变量

> 变量名=变量值，赋值时等号两侧不能有空格，变量名前不能有符号，若变量名有空格，则需要用双引号包裹。为了区分变量名和命令名，习惯上变量名是全部大写的。

- 保证只读性：readonly 变量名
- 全局变量设置：export 变量名/export 变量名=变量值

## 位置参数

- $0 代表当前 shell 程序的文件名，不是位置参数
- $1 代表第一个位置参数
- $2 代表第二个位置参数，以此类推

## 预定义变量

在 shell 启动时定义的变量，和环境变量不同的是，这些变量是不能被用户重新定义的。

- \$\# 位置参数的数量
- \$\* 所有位置参数的内容
- \$\? 命令执行后返回的状态，用于检查上一个命令执行是否正确，0 是正确，非 0 是出错
- \$\$ 当前进程的进程号，常用于暂存文件的名字，保证文件名字不会重复
- \$\! 后台运行的最后一个进程号
- \$0 当前执行的进程名

## 参数置换变量

- 变量=${参数-word}：设置了参数则变量值等于参数，否则等于 word
- 变量=${参数=word}：设置了参数则变量值等于参数，否则等于 word，并用 word 替换参数的值
- 变量=${参数?word}：设置了参数则变量值等于参数，否则显示 word 并从 shell 中退出，常用于出错指示
- 变量=${参数+word}：设置了参数则用 word 替换，否则不进行置换

# Shell 流程控制

## 测试命令

### 数值测试

- -eq 等于则为真
- -ne 不等于则为真
- -gt 大于则为真
- -ge 大于等于则为真
- -lt 小于则为真
- -le 小于等于则为真

### 字符串测试

- = 等于则为真
- != 不等于则为真
- -z 字符串 字符串长度伪则为真
- -n 字符串 字符串长度不伪则为真

### 文件测试

- -e 文件名 文件存在则为真
- -r 文件名 文件存在且可读则为真
- -w 文件名 文件存在且可写则为真
- -x 文件名 文件存在且可执行为为真
- -s 文件名 文件存在且至少有一个字符则为真
- -d 文件名 文件存在且为目录则为真
- -f 文件名 文件存在且为普通文件则为真
- -c 文件名 文件存在且为字符型特殊文件则为真
- -b 文件名 文件存在且为块特殊文件则为真

### 逻辑操作符

- 与 (! )
- 或 (-o)
- 非 (-a)

### 运算表达式

$[expression]

```bash
var1 = 2
var2 = $[var1*10+2]
```

## if 条件语句

```bash
if 条件命令穿
then
条件为真时的命令串
else
条件为假时的命令串
fi
```

## for 循环

```bash
for 变量名 [in数值列表]
do 若干个命令
done
```

变量名可以使用户选择的任何字符串，如果变量名是 `var`，则在 `in` 之后给出的数值将顺序替换循环命令列表中的 `$var`。  
如果省略了 `in`，则变量 `var` 取值是位置参数。

## while 循环

```bash
while
若干个命令行1
do
若干个命令行2
done
```

只要 `while` 的 “若干个命令行 1” 中最后一个命令的返回状态为真，`while` 循环就继续执行 `do...done` 之间的 “若干个命令行 2”

## until 循环

```bash
until
若干个命令行1
do
若干个命令行2
done
```

和 `while` 循环的区别是：`until` 在条件为假时继续执行循环
。

## case 条件选择

```bash
case string in
exp-1)
若干个命令行1
;;
exp-2)
若干个命令行2
;;
...
*)
其他命令行
esac
```

`shell` 通过计算字符串 string 的值，依次和 `exp-1`, `exp-2`, ... 等进行比较，找到匹配项后，执行下面的命令直到遇到一对分号为止

## 无条件控制语句

`break` 用于立即终止当前循环执行；
`continue` 用于结束当前循环，进入下一个循环的执行；
上面两个语句，只有放在 do 和 done 之间才有效。

## 函数定义

```bash
functionname
{
    若干命令行
}
```

函数定义无需参数说明，在调用函数可以带参数，会分别赋予相应位置的参数，`functionname param1 param2 ...`
